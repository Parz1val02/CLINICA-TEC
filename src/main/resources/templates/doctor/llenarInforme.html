<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<title>Responder Cuestionario</title>
<head th:replace="~{fragmentos/cabecera.html::cabecera(titulo='Rellenar Informe')}">
</head>


<body class="">

<!-- ===============================================-->
<!--    Main Content-->
<!-- ===============================================-->
<main class="main" id="top">

    <div style="padding: 0 50px 50px 50px;" data-layout="container">
        <nav th:replace="~{fragmentos/sidebardoctor.html::sideBar}"></nav>
        <div class="content">
            <nav th:replace="~{fragmentos/topbardoctor.html::topBar}"></nav>
            <div class="content">
                <div class="card mb-3 bg-card-gradient">
                    <div class="card-body" style="background: white;">
                        <div class="row justify-content-between align-items-center">
                            <div class="col-md-11">
                                <h1 class="mb-2 mb-md-0" style="color: #0032aa; font-weight: bold; padding-left: 15px; padding-bottom: 5px">
                                    Llenar Informe
                                </h1>
                            </div>
                            <div class="col-md-11">
                                <h5 class="mb-2 mb-md-0" style="color: #3d8af7; font-weight: bold; padding-left: 15px">
                                    Rellene los siguientes campos
                                </h5>
                                <h5 class="mb-2 mb-md-0" style="color: #3d8af7; font-weight: bold; padding-left: 15px" th:text="|Nombre del tipo de informe: ${titulo}|">
                                </h5>
                            </div>
                        </div>
                        <br>
                        <div>
                            <form th:action="@{/doctor/rellenarInforme}" method="post">
                                <h6>Receta</h6>
                                <div class="row mb-3" id="containermedicamentos" style="padding: 0 1.75rem;margin-bottom: 1rem;">
                                    <div class="container-fluid mb-3" id="superminicontainer">
                                        <div class="container-fluid mb-3" id = "minicontainer">
                                            <div class="row mb-3">
                                                <div class="col">
                                                    <div class="d-flex align-items-center">
                                                        <label for="medicamento" class="mr-2">Medicamento:</label>
                                                        <select class="form-control" th:classappend="${medicamentomsg != null ? 'is-invalid' : ''}" name="medicamento" id="medicamento">
                                                            <option th:each="medicament : ${listmedic}" th:value="${medicament.id}" th:text="${medicament.nombre}"></option>
                                                        </select>
                                                    </div>
                                                    <div class="invalid-feedback" th:if="${medicamentomsg != null}" th:text="${medicamentomsg}"></div>
                                                </div>
                                                <div class="col">
                                                    <div class="d-flex align-items-center">
                                                        <label for="cantidad">Cantidad:</label>
                                                        <input class="form-control" id="cantidad" name="cantidad"/>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col">
                                                    <label for="observaciones">Observaciones</label>
                                                    <input type="text" class="form-control" style="min-height: 50px;" id="observaciones" name="observaciones">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="container-fluid mb-3" id="superminicontainer2">
                                    </div>
                                    <div id="divpacomentario">
                                        <label for="comentario">Comentario</label>
                                        <input type="text" class="form-control"  th:classappend="${comentariomsg!=null?'is-invalid':''}"
                                               style="min-height: 100px;" id="comentario" name="comentario" required>
                                        <div class="invalid-feedback" th:if="${comentariomsg!=null}" th:text="${comentariomsg}"></div>
                                    </div>
                                </div>
                                <div class="container-fluid mt-3 mb-3">
                                    <button type="button" class="btn btn-secondary" style="background-color: #0eb4fd " onclick="agregarMedicamento()">Agregar medicamento</button>
                                </div>
                                <h6>Informe</h6>
                                <div class="row" style="padding: 0 1.75rem;margin-bottom: 1rem;">
                                    <label for="diagnostico">Diagnóstico</label>
                                    <input type="text" class="form-control"  th:classappend="${diagnosticomsg!=null?'is-invalid':''}"
                                           style="min-height: 100px;" id="diagnostico" name="diagnostico" required>
                                    <div class="invalid-feedback" th:if="${diagnosticomsg!=null}" th:text="${diagnosticomsg}"></div>
                                </div>
                                <div class="row" style="padding: 0 1.75rem;margin-bottom: 1rem;">
                                    <label for="bitacora">Bitácora</label>
                                    <input type="text" class="form-control"  th:classappend="${bitacoramsg!=null?'is-invalid':''}"
                                           style="min-height: 50px;" id="bitacora" name="bitacora" required>
                                    <div class="invalid-feedback" th:if="${bitacoramsg!=null}" th:text="${bitacoramsg}"></div>
                                </div>

                                <div class="row" style="padding: 0 1.75rem;margin-bottom: 1rem;">
                                    <label for="tratamiento">Tratamiento</label>
                                    <input type="text" class="form-control" style="min-height: 50px;" th:classappend="${tratamientomsg!=null?'is-invalid':''}" id="tratamiento" name="tratamiento" required>
                                    <div class="invalid-feedback" th:if="${tratamientomsg!=null}" th:text="${tratamientomsg}"></div>
                                </div>
                                <div th:each="pregunta, status : ${informe.listacampos}">
                                    <div class="row" style="padding: 0 1.75rem;">
                                        <div class="col mb-3" style="padding: 0;">
                                            <label class="form-label" for="respuestasInput" th:text="${pregunta}"></label>
                                            <input type="text" class="form-control" style="min-height: 50px;" th:name="'respuestas'" />
                                        </div>
                                    </div>
                                    <br>
                                </div>

                                <input type="hidden" id="respuestasInput" name="listarespuestas" />
                                <input type="hidden" id="medicamentosInput" name="listamedicamentos" />
                                <input type="hidden" id="observacionesInput" name="listaobservaciones" />
                                <input type="hidden" id="cantidadesInput" name="listacantidades" />
                                <div style="text-align: center;">
                                    <button class="btn btn-primary" type="submit" onclick="enviarRespuestas()" style="border-radius: 15px;">Enviar respuestas</button>
                                    <a class="btn btn-secondary" style="text-align: center;background: #748194; border-radius: 15px;" th:href="@{/paciente/cuestionarios}">Cancelar</a>
                                </div>
                            </form>

                            <script>
                                function enviarRespuestas() {
                                    var respuestas = [];
                                    var inputs = document.querySelectorAll('input[name="respuestas"]');

                                    inputs.forEach(function(input) {
                                        respuestas.push(input.value);
                                    });

                                    var medicamentos = [];
                                    var cantidades = [];
                                    var observaciones = [];

                                    var inputscantidades = document.querySelectorAll('input[name="cantidad"]');
                                    var inputobservaciones = document.querySelectorAll('input[name="observaciones"]');
                                    var inputmedicamentos = document.querySelectorAll('select[name="medicamento"]');

                                    inputscantidades.forEach(function (x){
                                        cantidades.push(x.value);
                                    })

                                    inputobservaciones.forEach(function (x){
                                        observaciones.push(x.value);
                                    })

                                    inputmedicamentos.forEach(function (x){
                                        medicamentos.push(x.value);
                                    })

                                    document.getElementById('respuestasInput').value = respuestas.join(">%%%%%<%%%%>%%%%%<");
                                    document.getElementById('observacionesInput').value = observaciones.join(">%%%%%<%%%%>%%%%%<");
                                    document.getElementById('cantidadesInput').value = cantidades.join(">%%%%%<%%%%>%%%%%<");
                                    document.getElementById('medicamentosInput').value = medicamentos.join(">%%%%%<%%%%>%%%%%<");
                                    document.getElementById('observacionesInput').form.submit();
                                    document.getElementById('cantidadesInput').form.submit();
                                    document.getElementById('medicamentosInput').form.submit();
                                    document.getElementById('respuestasInput').form.submit();

                                }

                                function agregarMedicamento() {
                                    var containerpalmedic = document.querySelector('#superminicontainer2');
                                    var selectmed = document.querySelector('#superminicontainer');
                                    var col1 = selectmed.innerHTML;

                                    containerpalmedic.innerHTML += col1;
                                }

                            </script>

                    </div>
                </div>
            </div>

            <footer th:replace="~{fragmentos/footer.html::footer}"></footer>
        </div>
    </div>
</main>
<!-- ===============================================-->
<!--    End of Main Content-->
<!-- ===============================================-->




<!-- ===============================================-->
<!--    JavaScripts-->
<!-- ===============================================-->
<div th:replace="~{fragmentos/scripts.html::scripts}"></div>
</body>

</html>>

